<!DOCTYPE html>
<html>
  <head>
    <script type="module">
      const width = 6;
      const height = 12;
      const squareSize = 50;

      let c = document.getElementById("canvas");
      c.width = width * squareSize;
      c.height = height * squareSize;

      var ctx = c.getContext("2d");

      class GridState {
        #grid;
        #playing;

        constructor() {
          this.#grid = Array(height).fill(Array(width).fill());
          this.#playing = true;
        }

        get grid() {
          return this.#grid;
        }

        loadRow() {
          if (!this.#grid[0].every((x) => x === undefined)) {
            // top row is not empty, game over
            this.#playing = false;
            return;
          }

          // shed top row
          this.#grid.shift();

          // add row to bottom
          this.#grid.push(Array(width).fill("r"));
        }
      }

      const gs = new GridState();
      drawGrid(gs);

      setInterval(() => {
        gs.loadRow();
        drawGrid(gs);
      }, 3000);

      function drawGrid(gs) {
        ctx.clearRect(0, 0, c.width, c.height);
        for (var y = 0; y < gs.grid.length; y++) {
          for (var x = 0; x < gs.grid[y].length; x++) {
            drawSquare(x * squareSize, y * squareSize, squareSize, gs.grid[y][x]);
          }
        }
      }

      function drawSquare(x, y, s, c) {
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x + s, y);
        ctx.lineTo(x + s, y + s);
        ctx.lineTo(x, y + s);
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.closePath();
        if (c) {
          ctx.fillStyle = "black";
          ctx.font = "24px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(c, x + s / 2, y + s / 2);
        }
      }
    </script>
  </head>
  <body>
    <canvas id="canvas"></canvas>
  </body>
</html>
